# 工作流指南

本文档详细介绍 Paper Master 的完整工作流程（5+2 角色协作）。

## 🚀 快速开始

### 前置准备

1. 准备论文格式要求文档（Word/PDF）
2. 使用 [Mineru](https://github.com/opendatalab/MinerU) 将格式要求转换为 MD 格式
3. 将转换后的 MD 文件放入 `templates/user/` 目录

### 推荐工具

| 工具 | 说明 |
|------|------|
| **Kiro** | AWS 出品，推荐 |
| **Cursor** | 主流 AI 编辑器 |
| **VS Code + Copilot** | 微软官方方案 |

---

## 📋 完整工作流程

### 阶段 1：格式分析

**角色**：Format_Analyst（格式分析师）

**操作**：
```
用户：我需要写一篇关于 XX 的结课论文，格式要求在 templates/user/xxx.md

AI（Format_Analyst）：
好的，我来分析格式要求并确认以下信息：
1. 论文类型：结课论文
2. 格式模板：templates/user/xxx.md
3. 字数要求：3000字
4. 参考文献格式：GB/T 7714
5. 代码实现：是 / 否
6. 配图需求：是 / 否
...
```

**输出**：`格式规范.md`

---

### 阶段 2：资料查询

**角色**：Research_Collector（资料查询者）

**操作**：
```
用户：请查询相关资料

AI（Research_Collector）：
我将搜索以下关键词的相关资料：
- 关键词1
- 关键词2
...

[整理资料和参考文献]
```

**输出**：`资料汇编.md`、`参考文献.md`

---

### 阶段 3：大纲创建

**角色**：Outline_Architect（大纲创作师）

**操作**：
```
AI（Outline_Architect）：
根据资料和格式要求，我设计了以下论文大纲：

1. 引言（约 500 字）
2. XX 理论概述（约 800 字）
3. XX 分析（约 1000 字）
4. 结论（约 400 字）

请确认此大纲是否合适？
```

**用户确认后，输出**：`论文大纲.md`

---

### 阶段 3.5：代码实现（选用）

**角色**：Code_Implementer（代码撰写者）

**触发条件**：格式规范中标注"需要代码实现"

**操作**：
```
AI（Code_Implementer）：
根据大纲，我将实现以下代码：
- main.py：XXX 算法核心实现
- 注释对应论文章节，便于引用

[编写代码]
```

**输出**：`code/` 目录（main.py、README.md、requirements.txt）

---

### 阶段 4：内容撰写

**角色**：Content_Writer（内容填充者）

**操作**：
```
用户：请开始撰写，先写引言

AI（Content_Writer）：
[撰写引言部分]

---
引言部分已完成，保存到 content/01_引言.md
字数：约 520 字

继续撰写下一部分吗？
```

**输出**：`content/` 目录下的各章节 MD 文件

**特点**：
- 每次只写一个章节
- 每个章节单独保存
- 用户可随时要求修改

---

### 阶段 4.5：图片生成（选用）

**角色**：Figure_Designer（图片生成师）

**触发条件**：格式规范中标注"需要配图"

**操作**：
```
AI（Figure_Designer）：
根据论文内容，我将生成以下配图：
1. fig1_framework.png - 系统框架图
2. fig2_flowchart.png - 流程图

[生成 Prompt，调用 nanobanana]
```

**Prompt 公式**：`框架图描述 + 顶会风格 Prompt + 设计风格`

**输出**：`figures/` 目录（PNG 图片 + README.md）

---

### 阶段 5：HTML 生成

**角色**：HTML_Formatter（HTML 格式化专家）

**操作**：
```
用户：所有内容已完成，请生成 HTML

AI（HTML_Formatter）：
[组合所有章节，生成带格式的 HTML]

HTML 文件已生成：output/论文.html

使用方法：
1. 在浏览器中打开 HTML 文件
2. 全选（Ctrl+A）
3. 复制（Ctrl+C）
4. 粘贴到 Word（Ctrl+V）
```

**输出**：`output/论文.html`

---

## 📁 项目文件结构

完成一个论文项目后，文件结构如下：

```
projects/我的论文_20251230/
├── 格式规范.md           # 格式分析师输出
├── 资料汇编.md           # 资料查询者输出
├── 参考文献.md           # 资料查询者输出
├── 论文大纲.md           # 大纲创作师输出
├── content/              # 内容填充者输出
│   ├── 00_摘要.md
│   ├── 01_引言.md
│   ├── 02_理论概述.md
│   ├── 03_分析.md
│   └── 04_结论.md
├── code/                 # 代码撰写者输出（选用）
│   ├── main.py
│   ├── README.md
│   └── requirements.txt
├── figures/              # 图片生成师输出（选用）
│   ├── fig1_framework.png
│   └── README.md
└── output/               # HTML 格式化专家输出
    └── 论文.html
```

---

## 💡 最佳实践

### 1. 格式要求准备

- 尽量提供详细的格式要求
- 使用 Mineru 转换可保留格式信息
- 如有学校模板，一定要使用

### 2. 资料查询

- 明确告知论文主题和关键词
- 可以指定需要的资料类型（数据/案例/理论等）
- 资料不够时可要求补充查询

### 3. 大纲确认

- 大纲是论文的骨架，务必认真确认
- 可以要求调整章节结构或字数分配
- 确认后再开始撰写

### 4. 代码实现（如需要）

- 在内容撰写前完成代码
- 代码注释要对应论文章节
- 确保代码可运行

### 5. 内容迭代

- 每个章节可以多次修改
- 发现问题及时告知 AI 修改
- 保持和前文的逻辑连贯

### 6. 配图生成（如需要）

- 明确图片类型（架构图/流程图/对比图）
- 默认使用顶会莫兰迪风格
- 图片命名规范：fig1_xxx.png

### 7. HTML 检查

- 粘贴到 Word 后仔细检查格式
- 页眉页脚需手动添加
- 目录需在 Word 中生成
- 数学公式需用公式编辑器处理

---

## 🔧 常用命令

```bash
# 初始化新论文项目
python tools/project_manager.py init 我的论文

# 验证项目结构
python tools/project_manager.py validate projects/我的论文_20251230
```
